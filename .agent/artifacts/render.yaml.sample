# Render.com Service Configuration
# This file defines the infrastructure for deploying http-nu on Render.com
# Documentation: https://render.com/docs/yaml-spec

services:
  # Main HTTP service
  - type: web
    name: http-nu
    runtime: docker
    
    # Repository settings
    repo: https://github.com/YOUR_USERNAME/http-nu # Update this!
    branch: main
    
    # Docker configuration
    dockerfilePath: ./Dockerfile
    dockerContext: .
    
    # Auto-deploy on git push
    autoDeploy: true
    
    # Region (choose closest to your users)
    # Options: oregon, frankfurt, singapore, ohio, virginia
    region: oregon
    
    # Service plan
    # Options: free, starter, standard, pro
    # Free: 512MB RAM, sleeps after 15min inactivity
    # Starter: $7/mo, 512MB RAM, always on
    plan: starter
    
    # Environment variables
    envVars:
      - key: LOG_FORMAT
        value: jsonl
      
      - key: RUST_LOG
        value: info
      
      # PORT is automatically set by Render
      # No need to define it here
    
    # Health check configuration
    healthCheckPath: /health
    
    # Build settings
    buildFilter:
      paths:
        - src/**
        - Cargo.toml
        - Cargo.lock
        - Dockerfile
        - serve.nu
      ignoredPaths:
        - docs/**
        - tests/**
        - benchmarks/**
        - "*.md"
    
    # Scaling (optional)
    # numInstances: 1
    
    # Disk storage (optional, for persistent data)
    # disk:
    #   name: http-nu-data
    #   mountPath: /data
    #   sizeGB: 1

  # Optional: Background worker for --services mode with store
  # Uncomment if you need the cross-stream services feature
  # - type: worker
  #   name: http-nu-worker
  #   runtime: docker
  #   repo: https://github.com/YOUR_USERNAME/http-nu
  #   branch: main
  #   dockerfilePath: ./Dockerfile
  #   dockerContext: .
  #   autoDeploy: true
  #   region: oregon
  #   plan: starter
  #   envVars:
  #     - key: RUST_LOG
  #       value: info
  #   startCommand: http-nu --store /data/store --services :3001 /app/serve.nu
  #   disk:
  #     name: http-nu-store
  #     mountPath: /data
  #     sizeGB: 1

# Optional: Database (if needed)
# databases:
#   - name: http-nu-db
#     databaseName: http_nu
#     user: http_nu
#     plan: starter

# Notes:
# 1. Update the repo URL with your GitHub username/organization
# 2. Ensure your Dockerfile is in the repository root
# 3. The PORT environment variable is automatically set by Render
# 4. Health checks run every 30 seconds by default
# 5. Free tier services sleep after 15 minutes of inactivity
# 6. Starter tier and above are always on
# 7. You can override environment variables in the Render dashboard
